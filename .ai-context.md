```markdown
# AI CONTEXT: DJ ZEN EYER THEME

**Version:** 12.0.0  
**Architecture:** WordPress Headless (REST API Backend + React SPA Frontend)  
**Production:** https://djzeneyer.com  
**Last Updated:** 2025-10-30

---

## SCOPE LIMITATION

**This repository contains ONLY the WordPress theme.** Production infrastructure (plugins, server configs, CDN) is NOT in this repo but documented below.

---

## PRODUCTION STACK

```
User → Cloudflare → Quic.Cloud CDN → LiteSpeed Server → WordPress + Custom Plugins → Theme (this repo) → MySQL
```

| Layer | Technology | Purpose |
|-------|------------|---------|
| **Edge** | Cloudflare | WAF, DDoS, SSL/TLS, DNS proxy |
| **CDN** | Quic.Cloud | Global edge cache, image optimization |
| **Server** | LiteSpeed | HTTP/3, server-level cache, .htaccess |
| **Runtime** | PHP 8.1 + OPcache | WordPress execution |
| **Cache** | Redis + LiteSpeed Cache | Object cache + page cache |
| **CMS** | WordPress 6.4+ | Headless backend |
| **Frontend** | React 18 + Vite 4 + TypeScript 5 | SPA built with this theme |
| **Database** | MySQL 8.0 | InnoDB, query cache |

---

## THEME FILE STRUCTURE

```
djzeneyer/                       ← THIS REPO
├── inc/
│   ├── djz-config.php          ← Single source of truth (all config)
│   └── djz-helpers.php         ← Helper functions (djz_* prefix)
├── src/                         ← React source
├── dist/                        ← Vite build output (excluded from repo)
├── functions.php                ← WordPress hooks, REST endpoints
├── header.php                   ← SEO meta, Schema.org, CSP nonce usage
├── footer.php
├── style.css
├── index.php
├── single.php
├── page.php
├── package.json
├── vite.config.ts
├── tsconfig.json
├── composer.json
└── README.md
```

---

## EXTERNAL DEPENDENCIES (NOT IN REPO)

### Custom Plugins (Production Only)

**1. CSP Nonce Plugin** (`wp-content/plugins/djzeneyer-csp/`)  
Generates dynamic nonce for Content Security Policy headers. Prevents XSS by allowing only nonce-tagged inline scripts/styles.

```
// djzeneyer-csp.php (simplified)
function djzeneyer_get_csp_nonce() {
    static $nonce = null;
    if ($nonce === null) {
        $nonce = base64_encode(random_bytes(16));
    }
    return $nonce;
}
add_action('send_headers', function() {
    $nonce = djzeneyer_get_csp_nonce();
    header("Content-Security-Policy: default-src 'self'; script-src 'self' 'nonce-{$nonce}'; style-src 'self' 'nonce-{$nonce}';");
});
```

**Theme usage:** `<script nonce="<?php echo djzeneyer_get_csp_nonce(); ?>">...</script>`

---

**2. GamiPress API Lite Plugin** (`wp-content/plugins/djz-gamipress-api-lite/`)  
REST API for gamification data. Endpoint: `/wp-json/djzeneyer/v1/gamipress/{user_id}`

**Response format:**
```
{
  "success": true,
  "user": 123,
  "points_total": 1500,
  "points_detail": [{"type": "points", "name": "Points", "points": 1500}],
  "achievements": [{"id": 456, "title": "First Login", "type": "achievement", "points": 10, "date": "2025-10-26 10:30:00"}],
  "rank": "Zen Master",
  "ranks": [{"id": 789, "title": "Novice", "current": false}],
  "stats": {"total_achievements": 15, "total_ranks": 5}
}
```

**Cache:** 5 minutes, auto-flush on GamiPress events (`gamipress_update_user_points`, `gamipress_award_achievement`, `gamipress_update_user_rank`)

---

### Third-Party Plugins (Active)

| Plugin | Purpose | Critical |
|--------|---------|----------|
| GamiPress | Gamification engine | Yes |
| LiteSpeed Cache | Page/object cache, image optimization | Yes |
| Rank Math SEO | Sitemaps, Schema.org, canonical URLs | Yes |
| Wordfence Security | WAF, malware scanner, 2FA | Optional |
| UpdraftPlus | Daily backups | Yes |

---

### Server Configuration (NOT IN REPO)

**`.htaccess` (simplified excerpt):**
```
# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Security headers
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "DENY"
Header set Strict-Transport-Security "max-age=31536000; includeSubDomains"

# LiteSpeed cache
<IfModule LiteSpeed>
    CacheLookup on
</IfModule>

# Cloudflare Real IP
SetEnvIf CF-Connecting-IP "^(.*)$" REMOTE_ADDR=$1

# Browser caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>
```

---

## CRITICAL ARCHITECTURE DECISIONS

### 1. Centralized Configuration
**File:** `inc/djz-config.php`  
All site config (social links, SEO defaults, colors, feature flags) in ONE file. Zero hardcoding elsewhere.

```
// djz-config.php structure
return [
    'social' => ['youtube' => 'https://youtube.com/@djzeneyer'],
    'seo' => ['site_name' => 'DJ Zen Eyer', 'default_image' => '/assets/og-image.jpg'],
    'colors' => ['primary' => '#ff6b35'],
    'features' => ['gamification' => true, 'comments' => false],
];
```

**Usage:** `djz_config('social.youtube')`

---

### 2. Headless WordPress
WordPress serves JSON via REST API. React (built with Vite) consumes endpoints and renders UI. No WordPress templates render frontend HTML (except initial HTML shell in `header.php`/`footer.php`).

**REST endpoints:**
- `/wp-json/wp/v2/posts`
- `/wp-json/djzeneyer/v1/gamipress/{user_id}`

---

### 3. Performance Strategy

**Edge caching (Cloudflare):**
- Static assets: `/wp-content/*` cached 1 month
- Bypass: `/wp-admin/*`, `/wp-json/*`

**Server caching (LiteSpeed):**
- Page cache: 1 hour (public), 5 minutes (logged-in users)
- Object cache: Redis backend
- Image optimization: WebP conversion, lazy loading

**Bundle optimization (Vite):**
- Code splitting
- Tree shaking
- Minification
- Target: <300KB JS, <100KB CSS

---

### 4. Security Layers

**Cloudflare WAF:** Blocks malicious IPs, challenge suspicious bots  
**CSP Nonce:** Dynamic nonce for inline scripts/styles  
**CORS:** Restricted origins in REST API  
**Input sanitization:** All user input sanitized (WordPress functions)  
**Rate limiting:** 100 req/min per IP on REST endpoints  
**HSTS:** Force HTTPS with 1-year max-age

---

## ANALYSIS REQUIREMENTS

### Priority 1: Security
- [ ] **XSS vulnerabilities:** Check inline scripts without nonce in `header.php`, `footer.php`
- [ ] **CSRF protection:** Verify nonce usage in forms, AJAX calls
- [ ] **SQL injection:** Review custom DB queries (avoid `$wpdb->query()` with user input)
- [ ] **REST API security:** Check authentication on `/wp-json/djzeneyer/v1/*` endpoints
- [ ] **CORS misconfiguration:** Verify `djz_allowed_origins()` in `functions.php`
- [ ] **Sensitive data exposure:** Check for hardcoded credentials, API keys

### Priority 2: Performance
- [ ] **Bundle size:** Target <300KB JS, <100KB CSS (check `vite.config.ts`)
- [ ] **Lazy loading:** Verify React.lazy() usage for code splitting
- [ ] **Database queries:** Identify N+1 problems, missing indexes
- [ ] **Image optimization:** Check WebP usage, responsive images, lazy loading
- [ ] **Cache invalidation:** Verify cache purge on content update
- [ ] **Third-party scripts:** Audit async/defer loading of external JS

### Priority 3: Code Quality
- [ ] **PHP standards:** PSR-12 compliance
- [ ] **React standards:** Airbnb style guide, React Hooks best practices
- [ ] **TypeScript:** Strict mode enabled, no `any` types
- [ ] **Error handling:** Consistent use of try/catch, WP_Error
- [ ] **Documentation:** PHPDoc, JSDoc for all functions
- [ ] **Naming conventions:** Consistent `djz_*` prefix for functions, `DJZ_*` for constants

### Priority 4: SEO & Accessibility
- [ ] **Schema.org:** Validate JSON-LD in `header.php`
- [ ] **Open Graph:** Check completeness (og:title, og:description, og:image)
- [ ] **Canonical URLs:** Verify correct implementation
- [ ] **ARIA labels:** Check semantic HTML, screen reader support
- [ ] **Keyboard navigation:** Test focus management, tab order
- [ ] **Mobile-first:** Responsive design, touch targets ≥44px

### Priority 5: Maintainability
- [ ] **Single Responsibility:** Check for god functions, bloated classes
- [ ] **DRY violations:** Identify repeated code
- [ ] **Magic numbers:** Replace with named constants
- [ ] **Dependency injection:** Reduce tight coupling
- [ ] **Testability:** Identify untestable code

---

## KNOWN CONSTRAINTS

1. **GamiPress dependency:** Theme requires GamiPress API Lite plugin active
2. **LiteSpeed required:** Performance optimizations assume LiteSpeed server
3. **Cloudflare required:** Security features depend on Cloudflare WAF/DDoS
4. **React 18:** Suspense/Transitions may not work in React <18
5. **PHP 8.1+:** Uses named arguments, enums (not compatible with PHP <8.0)

---

## OUTPUT FORMAT

Provide analysis as:

### 1. Executive Summary
2-3 paragraphs: overall health, critical blockers, strengths.

### 2. Critical Issues (P0)
Security vulnerabilities, data loss risks, performance blockers.  
**Format:** Issue → Impact → Fix (with code snippet)

### 3. High Priority (P1)
Performance bottlenecks, major bugs, security hardening.  
**Format:** Issue → Root cause → Recommendation

### 4. Medium Priority (P2)
Code quality, refactoring opportunities, minor bugs.

### 5. Low Priority (P3)
Nice-to-haves, future features, minor optimizations.

### 6. Metrics
- Bundle size (current vs target)
- Database query count (per page)
- Core Web Vitals (LCP, FID, CLS)
- Accessibility score (0-100)

---

## VALIDATION CHECKLIST

When analyzing, verify:
- [ ] CSP nonce used in ALL inline scripts/styles
- [ ] GamiPress API responses cached and auto-flushed
- [ ] REST endpoints have proper authentication
- [ ] No hardcoded values (all in `djz-config.php`)
- [ ] Vite bundle optimized (code splitting, tree shaking)
- [ ] Schema.org JSON-LD valid (Google Structured Data Test)
- [ ] No `console.log()` in production React code
- [ ] All user input sanitized (SQL, XSS, CSRF)

---

**END OF CONTEXT**